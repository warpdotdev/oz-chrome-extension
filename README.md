# oz-chrome-extension

`oz-chrome-extension` is a Path-B-first Chrome extension project for user-authored site customization scripts generated by Oz cloud agents.

## MVP shape

- User enters an Oz API key in extension settings.
- User prompts customization while on a site.
- Extension sends prompt + page context to Oz production API.
- Extension polls run status and reads PR URL from structured `PULL_REQUEST` artifacts in `RunItem.artifacts`.
- Extension fetches generated script from PR head files, validates it, stores it, and auto-registers it via `chrome.userScripts` after successful import.

## Monorepo packages

- `packages/extension`: Manifest V3 extension shell.
- `packages/oz-client`: Oz production API client and run/artifact helpers.
- `packages/oz-runtime`: Shared runtime logic for script import/validation/lifecycle.
- `packages/shared`: Shared contracts and primitives.

## Important constraints

- Use production Oz endpoints: `https://app.warp.dev/api/v1`.
- Use `oz` CLI for command-line Oz workflows.
- Do not parse run summary text for PR URLs; read `RunItem.artifacts` only.

## Build and load in Chrome

1. Install dependencies:
   - `npm install`
2. Build extension artifacts (this bundles workspace imports for Chrome runtime):
   - `npm run build`
3. Open `chrome://extensions`, enable **Developer mode**, click **Load unpacked**.
4. Select `packages/extension`.
5. If already loaded, click **Reload** after each `npm run build`.

If you skip `npm run build`, Chrome may show `Failed to resolve module specifier "@oz-chrome-extension/..."` while registering the service worker.

## Popup workflow

1. Click the extension toolbar icon.
2. If prompted, paste an Oz API key (`wk-...`) and save.
3. Enter an optional environment ID and a customization prompt.
4. Click **Run Oz agent** and watch live status updates:
   - run phase/state
   - status message
   - session link (when available)
5. On completion, the popup shows PR link and script id; the script is imported and enabled automatically.

## Future

The shared runtime package is intended to support a later embeddable `oz-js` library for site authors.
